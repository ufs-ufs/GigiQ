<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edukasi Visual - GigiQ</title>
    <!-- Bootstrap CSS (Minified) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome (Minified) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts (Optimized) -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        /* CSS Variabel untuk Mode Terang dan Gelap */
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --header-bg: #007bff;
            --header-text: #fff;
            --button-bg: #007bff;
            --button-text: #fff;
            --button-hover-bg: #0056b3;
            --footer-bg: #343a40;
            --footer-text: #fff;
            --spinner-color: #007bff;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --card-bg: #fff;
            --card-text: #212529;
            --modal-bg: #fff;
            --modal-text: #212529;
            --overlay-bg: rgba(0, 0, 0, 0.5);
            --default-thumbnail: 'https://via.placeholder.com/320x180.png?text=Video';
            --reset-button-bg: #dc3545;
            --reset-button-text: #fff;
            --reset-button-hover-bg: #c82333;
            --fab-bg: #28a745;
            --fab-hover-bg: #218838;
        }

        /* Mode Gelap */
        .dark-mode {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --header-bg: #1f1f1f;
            --header-text: #e0e0e0;
            --button-bg: #ffc107;
            --button-text: #212529;
            --button-hover-bg: #e6ac00;
            --footer-bg: #1f1f1f;
            --footer-text: #e0e0e0;
            --spinner-color: #e0e0e0;
            --shadow-color: rgba(255,255,255,0.1);
            --card-bg: #1f1f1f;
            --card-text: #e0e0e0;
            --modal-bg: #1f1f1f;
            --modal-text: #e0e0e0;
            --overlay-bg: rgba(255, 255, 255, 0.5);
            --reset-button-bg: #e74c3c;
            --reset-button-text: #fff;
            --reset-button-hover-bg: #c0392b;
            --fab-bg: #27ae60;
            --fab-hover-bg: #1e8449;
        }

        /* General Styles */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        /* Loading Animation */
        .loader {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .spinner-border {
            width: 2rem;
            height: 2rem;
            color: var(--spinner-color);
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 8px 12px; /* Mengurangi padding */
            z-index: 1000;
            box-shadow: 0 2px 4px var(--shadow-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .header h2 {
            margin: 0;
            font-size: 1.1rem; /* Mengurangi ukuran font */
        }

        /* Back Button */
        .back-button a {
            color: var(--header-text);
            text-decoration: none;
            font-size: 0.9rem; /* Mengurangi ukuran font */
            display: flex;
            align-items: center;
        }

        .back-button a:hover {
            color: #ffc107;
        }

        .back-button a i {
            margin-right: 4px; /* Mengurangi margin */
        }

        /* Dark Mode Toggle Icons Visibility */
        .dark-mode .dark-mode-toggle #sunIcon {
            display: none;
        }

        .dark-mode .dark-mode-toggle #moonIcon {
            display: inline;
        }

        body:not(.dark-mode) .dark-mode-toggle #moonIcon {
            display: none;
        }

        body:not(.dark-mode) .dark-mode-toggle #sunIcon {
            display: inline;
        }

        /* Toggle Switch Styles */
        .dark-mode-toggle {
            display: flex;
            align-items: center;
            cursor: pointer;
            color: #ffc107;
            transition: color 0.3s ease;
        }

        .dark-mode-toggle i {
            font-size: 0.9rem; /* Mengurangi ukuran ikon */
            margin-left: 4px; /* Mengurangi margin */
        }

        body.dark-mode .dark-mode-toggle {
            color: #ffeb3b;
        }

        /* Main Content */
        .main-content {
            padding: 65px 10px 65px 10px; /* Mengurangi padding */
            min-height: calc(100vh - 130px); /* Menyesuaikan tinggi min untuk footer dan tombol reset */
            transition: opacity 0.5s ease;
        }

        /* Search Bar */
        .search-bar {
            margin-bottom: 15px; /* Mengurangi margin */
        }

        /* Card Styles */
        .card {
            background-color: var(--card-bg);
            color: var(--card-text);
            box-shadow: 0 2px 8px var(--shadow-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            border: none;
            border-radius: 8px; /* Mengurangi border-radius */
            overflow: hidden;
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .card:hover {
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .card-body {
            padding: 8px; /* Mengurangi padding */
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .card-title {
            font-size: 0.9rem; /* Mengurangi ukuran font */
            margin-bottom: 6px; /* Mengurangi margin */
        }

        .card-text {
            font-size: 0.7rem; /* Mengurangi ukuran font */
            margin-bottom: 8px; /* Mengurangi margin */
            flex: 1;
        }

        .btn-primary {
            background-color: var(--button-bg);
            border: none;
            transition: background-color 0.3s ease;
            font-size: 0.7rem; /* Mengurangi ukuran font */
            padding: 4px 8px; /* Mengurangi padding */
        }

        .btn-primary:hover {
            background-color: var(--button-hover-bg);
        }

        /* Delete Button Styles */
        .btn-delete {
            position: absolute;
            top: 8px; /* Mengurangi posisi */
            right: 8px; /* Mengurangi posisi */
            background-color: rgba(220, 53, 69, 0.8); /* Semi-transparan */
            border: none;
            color: #fff;
            padding: 4px; /* Mengurangi padding */
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-delete:hover {
            background-color: rgba(200, 35, 51, 0.9);
            transform: scale(1.1);
        }

        /* Thumbnail Overlay */
        .thumbnail-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover .thumbnail-overlay {
            opacity: 1;
        }

        .thumbnail-overlay i {
            font-size: 1.3rem; /* Mengurangi ukuran ikon */
            color: #fff;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 6px 0; /* Mengurangi padding */
            background-color: var(--footer-bg);
            color: var(--footer-text);
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 1000;
            font-size: 0.8rem; /* Mengurangi ukuran font */
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Modal Styles */
        .modal-content {
            background-color: var(--modal-bg);
            color: var(--modal-text);
            border: none;
            border-radius: 8px; /* Mengurangi border-radius */
            box-shadow: 0 2px 8px var(--shadow-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .modal-header {
            border-bottom: none;
            padding: 12px; /* Mengurangi padding */
        }

        .modal-title {
            font-size: 1.1rem; /* Mengurangi ukuran font */
        }

        .modal-body {
            padding: 12px; /* Mengurangi padding */
        }

        .modal-body video {
            width: 100%;
            height: auto;
            border-radius: 4px; /* Mengurangi border-radius */
            margin-bottom: 12px; /* Mengurangi margin */
        }

        /* Reset Gallery Button */
        .reset-gallery {
            position: fixed;
            bottom: 16px; /* Mengurangi posisi */
            left: 16px; /* Mengurangi posisi */
            background-color: var(--reset-button-bg);
            color: var(--reset-button-text);
            border: none;
            border-radius: 50%;
            width: 40px; /* Mengurangi ukuran */
            height: 40px; /* Mengurangi ukuran */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 6px var(--shadow-color);
            transition: background-color 0.3s ease, transform 0.2s ease;
            z-index: 1001;
        }

        .reset-gallery:hover {
            background-color: var(--reset-button-hover-bg);
            transform: scale(1.1);
        }

        /* Floating Action Button (FAB) for Add Video */
        .fab {
            position: fixed;
            bottom: 16px; /* Sama dengan tombol reset */
            right: 16px; /* Mengurangi posisi */
            background-color: var(--fab-bg);
            color: var(--fab-text);
            border: none;
            border-radius: 50%;
            width: 50px; /* Mengurangi ukuran */
            height: 50px; /* Mengurangi ukuran */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: background-color 0.3s ease, transform 0.2s ease;
            z-index: 1001;
        }

        .fab:hover {
            background-color: var(--fab-hover-bg);
            transform: scale(1.1);
        }

        /* Responsive Adjustments */
        @media (max-width: 576px) {
            .header h2 {
                font-size: 1rem;
            }

            .dark-mode-toggle i {
                font-size: 0.8rem; /* Mengurangi ukuran ikon */
            }

            .footer {
                font-size: 0.7rem; /* Mengurangi ukuran font */
            }

            .card-title {
                font-size: 0.8rem; /* Mengurangi ukuran font */
            }

            .card-text {
                font-size: 0.6rem; /* Mengurangi ukuran font */
            }

            .btn-primary {
                font-size: 0.6rem; /* Mengurangi ukuran font */
                padding: 3px 6px; /* Mengurangi padding */
            }

            .thumbnail-overlay i {
                font-size: 1rem; /* Mengurangi ukuran ikon */
            }

            .reset-gallery {
                width: 30px; /* Mengurangi ukuran */
                height: 30px; /* Mengurangi ukuran */
            }

            .fab {
                width: 40px; /* Mengurangi ukuran */
                height: 40px; /* Mengurangi ukuran */
            }
        }

        /* Menambahkan kelas kustom untuk kolom lebih kecil */
        .col-lg-2, .col-md-3, .col-sm-4 {
            flex: 0 0 auto;
            width: 16.666667%;
        }

        @media (max-width: 992px) {
            .col-md-3 {
                width: 25%;
            }
        }

        @media (max-width: 768px) {
            .col-sm-4 {
                width: 33.333333%;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Animation -->
    <div class="loader" id="loader">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <!-- Back Button -->
        <div class="back-button">
            <a href="index.html"><i class="fas fa-arrow-left"></i> Kembali</a>
        </div>
        <h2 class="m-0">Edukasi Visual</h2>
        <!-- Toggle Switch for Dark Mode -->
        <div class="dark-mode-toggle form-check form-switch">
            <input class="form-check-input" type="checkbox" id="darkModeToggle">
            <label class="form-check-label" for="darkModeToggle">
                <i class="fas fa-sun" id="sunIcon"></i>
                <i class="fas fa-moon" id="moonIcon"></i>
            </label>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <!-- Search Bar -->
            <input type="text" class="form-control search-bar" id="searchBar" placeholder="Cari video...">
            <div class="row" id="videoGrid">
                <!-- Video Cards -->
                <!-- Video Cards akan ditambahkan secara dinamis melalui JavaScript -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        &copy; GigiQ - Aplikasi Edukasi Gigi By: UFS
    </div>

    <!-- Reset Gallery Button -->
    <button class="reset-gallery" id="resetGalleryBtn" title="Reset Gallery">
        <i class="fas fa-redo"></i>
    </button>

    <!-- Floating Action Button (FAB) for Add Video -->
    <button class="fab" id="fabAddVideo" data-bs-toggle="modal" data-bs-target="#addVideoModal" title="Tambah Video">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Reusable Video Modal -->
    <div class="modal fade" id="videoModal" tabindex="-1" aria-labelledby="videoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="videoModalLabel">Judul Video</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
                </div>
                <div class="modal-body">
                    <video controls id="modalVideo" class="w-100" poster="">
                        <source src="" type="video/mp4">
                        Browser Anda tidak mendukung elemen video.
                    </video>
                    <p class="mt-3" id="modalDescription">Deskripsi Video</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Video Modal -->
    <div class="modal fade" id="addVideoModal" tabindex="-1" aria-labelledby="addVideoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Video</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
                </div>
                <div class="modal-body">
                    <form id="addVideoForm">
                        <div class="mb-3">
                            <label for="videoTitle" class="form-label">Judul Video</label>
                            <input type="text" class="form-control" id="videoTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="videoDescription" class="form-label">Deskripsi Video</label>
                            <textarea class="form-control" id="videoDescription" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="videoFile" class="form-label">Pilih Video</label>
                            <input class="form-control" type="file" id="videoFile" accept="video/*" required>
                        </div>
                        <!-- Thumbnail (Opsional) Dihapus -->
                        <button type="submit" class="btn btn-primary">Tambahkan</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Bootstrap JS dan Dependencies dengan defer untuk non-blocking -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <!-- Custom JS -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let db;

            // Membuka atau membuat database
            const request = indexedDB.open('VideoDatabase', 1);

            request.onerror = function(event) {
                console.error('Database error:', event.target.errorCode);
            };

            request.onsuccess = function(event) {
                db = event.target.result;
                loadInitialVideos(); // Memuat video setelah database siap
            };

            request.onupgradeneeded = function(event) {
                db = event.target.result;
                // Membuat objek store untuk menyimpan video pengguna
                const objectStore = db.createObjectStore('userVideos', { keyPath: 'id', autoIncrement: true });
                objectStore.createIndex('title', 'title', { unique: false });
                objectStore.createIndex('description', 'description', { unique: false });
            };

            // Menghilangkan loader setelah halaman selesai dimuat
            window.addEventListener('load', function() {
                const loader = document.getElementById('loader');
                loader.classList.add('hidden');
            });

            // Dark Mode Toggle Functionality
            const darkModeToggle = document.getElementById('darkModeToggle');

            // Cek preferensi mode dari localStorage saat halaman dimuat
            const darkMode = localStorage.getItem('darkMode');
            if(darkMode === 'enabled') {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
            }

            // Event Listener untuk toggle switch
            darkModeToggle.addEventListener('change', function() {
                if(this.checked) {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('darkMode', 'enabled');
                } else {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('darkMode', 'disabled');
                }
            });

            // Event Listener untuk membuka modal dengan video yang sesuai
            const videoModal = document.getElementById('videoModal');
            videoModal.addEventListener('show.bs.modal', function (event) {
                // Element yang memicu modal
                const card = event.relatedTarget;

                // Mendapatkan data dari atribut data-video-*
                const videoSrc = card.getAttribute('data-video-src');
                const videoPoster = card.getAttribute('data-video-poster') || 'https://via.placeholder.com/320x180.png?text=Video';
                const videoTitle = card.getAttribute('data-video-title');
                const videoDescription = card.getAttribute('data-video-description');

                // Memperbarui konten modal
                const modalTitle = videoModal.querySelector('.modal-title');
                const modalVideo = videoModal.querySelector('#modalVideo');
                const modalDescription = videoModal.querySelector('#modalDescription');

                modalTitle.textContent = videoTitle;
                modalVideo.querySelector('source').src = videoSrc;
                modalVideo.poster = videoPoster;
                modalVideo.autoplay = true; // Mengatur video untuk autoplay
                modalVideo.load(); // Memuat ulang video dengan sumber baru
                modalDescription.textContent = videoDescription;
            });

            // Menghentikan video ketika modal ditutup
            videoModal.addEventListener('hidden.bs.modal', function () {
                const modalVideo = videoModal.querySelector('#modalVideo');
                modalVideo.pause();
                modalVideo.currentTime = 0;
                modalVideo.autoplay = false; // Nonaktifkan autoplay setelah video berhenti
            });

            // Add Video Functionality
            const addVideoForm = document.getElementById('addVideoForm');
            const videoGrid = document.getElementById('videoGrid');

            addVideoForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                const title = document.getElementById('videoTitle').value.trim();
                const description = document.getElementById('videoDescription').value.trim();
                const videoFileInput = document.getElementById('videoFile');

                if(videoFileInput.files.length === 0) {
                    alert('Silakan pilih file video.');
                    return;
                }

                const videoFile = videoFileInput.files[0];
                
                // Tambahkan validasi ukuran video (opsional)
                const MAX_VIDEO_SIZE = 100 * 1024 * 1024; // 100MB
                if (videoFile.size > MAX_VIDEO_SIZE) {
                    alert('Ukuran video terlalu besar. Maksimum 100MB.');
                    return;
                }

                // Otomatisasi pembuatan thumbnail
                try {
                    const thumbnailBlob = await generateThumbnail(videoFile);

                    const newVideo = {
                        title,
                        description,
                        src: videoFile, // Menyimpan Blob video
                        poster: thumbnailBlob // Menyimpan Blob thumbnail
                    };

                    // Simpan video baru ke IndexedDB
                    saveVideoToDB(newVideo).then(id => { // Mendapatkan ID video yang baru disimpan
                        // Setelah berhasil disimpan, muat ulang video dari DB untuk mendapatkan URL objek
                        loadUserVideosFromDB();
                    }).catch(error => {
                        console.error('Gagal menyimpan video:', error);
                        alert('Gagal menyimpan video.');
                    });

                    // Reset form
                    addVideoForm.reset();

                    // Tutup modal
                    const addVideoModal = bootstrap.Modal.getInstance(document.getElementById('addVideoModal'));
                    addVideoModal.hide();
                } catch (error) {
                    console.error('Gagal menghasilkan thumbnail:', error);
                    alert('Gagal menghasilkan thumbnail dari video. Silakan coba lagi.');
                }
            });

            // Function to generate thumbnail from video file
            function generateThumbnail(videoFile) {
                return new Promise((resolve, reject) => {
                    const video = document.createElement('video');
                    video.preload = 'metadata';
                    video.src = URL.createObjectURL(videoFile);
                    video.muted = true;
                    video.playsInline = true;

                    // Event saat data video sudah dimuat
                    video.addEventListener('loadeddata', () => {
                        console.log('Video loaded data.');
                        // Coba seek ke detik ke-1
                        video.currentTime = 1;
                    });

                    // Event saat seek selesai
                    video.addEventListener('seeked', () => {
                        console.log('Video seeked to 1 second.');
                        const canvas = document.createElement('canvas');
                        // Tentukan ukuran canvas sesuai dengan video
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        canvas.toBlob(blob => {
                            const thumbnailBlob = blob;
                            URL.revokeObjectURL(video.src); // Bersihkan URL object
                            console.log('Thumbnail generated.');
                            resolve(thumbnailBlob);
                        }, 'image/png');
                    });

                    // Event saat terjadi error dalam memuat video
                    video.addEventListener('error', (e) => {
                        console.error('Error loading video file:', e);
                        reject('Error loading video file.');
                    });
                });
            }

            // Search Functionality
            const searchBar = document.getElementById('searchBar');
            searchBar.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const cards = videoGrid.querySelectorAll('.card');

                cards.forEach(card => {
                    const title = card.getAttribute('data-video-title').toLowerCase();
                    const description = card.getAttribute('data-video-description').toLowerCase();

                    if(title.includes(query) || description.includes(query)) {
                        card.parentElement.style.display = 'block';
                    } else {
                        card.parentElement.style.display = 'none';
                    }
                });
            });

            // Function to load initial videos (statis dan pengguna)
            function loadInitialVideos() {
                const initialVideos = [
                    {
                        title: "Cara Menyikat Gigi yang Benar",
                        description: "Teknik menyikat gigi untuk mencegah kerusakan gigi. Sumber:youtube.com/@GigiMulutku",
                        src: "sikatgigi.mp4",
                        poster: "1.png" // Tambahkan path poster lokal
                    },
                    {
                        title: "Masalah Gigi Bungsu",
                        description: "Gigi bungsu yang tumbuh tidak normal dapat menyebabkan rasa sakit dan infeksi. Konsultasikan ke dokter gigi. Sumber:youtube.com/@esterdental370",
                        src: "gigibungsu.mp4",
                        poster: "5.png" // Tambahkan path poster lokal
                    },
                    {
                        title: "Bagaimana Scaling Gigi Bekerja",
                        description: "Scaling gigi adalah prosedur untuk melakukan pembersihan karang gigi.",
                        src: "scaling.mp4",
                        poster: "2.png" // Tambahkan path poster lokal
                    },
                    {
                        title: "Mengatasi Bau Mulut",
                        description: "Bersihkan lidah dan flossing secara teratur. Jika bau mulut berlanjut, periksakan ke dokter gigi. Sumber:youtube.com/@fdcdentalclinic.official",
                        src: "baumulut.mp4",
                        poster: "4.png" // Tambahkan path poster lokal
                    },
                    {
                        title: "Perawatan Saluran Akar",
                        description: "Perawatan saluran akar dilakukan untuk menghilangkan infeksi dan menyelamatkan gigi yang rusak. Sumber:youtube.com/@KlinikGigiJoyDentalJogja",
                        src: "psa.mp4",
                        poster: "6.png" // Tambahkan path poster lokal
                    },
                    {
                        title: "Tambal Gigi",
                        description: "Tambal gigi digunakan untuk memperbaiki kerusakan pada gigi akibat karies atau trauma. Sumber:www.youtube.com/@KlinikGigiJoyDentalJogja",
                        src: "tambal.mp4",
                        poster: "tambalgigi.webp" // Tambahkan path poster lokal
                    }
                    // Tambahkan lebih banyak video jika diperlukan
                ];

                // Muat video statis dengan menggunakan thumbnail lokal
                initialVideos.forEach(video => {
                    addVideoCard(video, false, null); // Tidak ada ID karena ini video statis
                });

                // Muat video pengguna dari IndexedDB
                loadUserVideosFromDB();
            }

            // Function to add a video card
            function addVideoCard(video, isUserAdded = false, id = null) {
                // Set thumbnailURL
                let thumbnailURL = video.poster ? video.poster : 'https://via.placeholder.com/320x180.png?text=Video';

                // Jika poster adalah Blob (untuk video pengguna), buat URL objek
                if (video.poster instanceof Blob) {
                    thumbnailURL = URL.createObjectURL(video.poster);
                }

                const colDiv = document.createElement('div');
                colDiv.className = 'col-lg-2 col-md-3 col-sm-4 mb-3'; // Menyesuaikan kelas kolom untuk ukuran lebih kecil

                const cardDiv = document.createElement('div');
                cardDiv.className = 'card';
                cardDiv.setAttribute('data-bs-toggle', 'modal');
                cardDiv.setAttribute('data-bs-target', '#videoModal');
                cardDiv.setAttribute('data-video-src', typeof video.src === 'string' ? video.src : URL.createObjectURL(video.src));
                cardDiv.setAttribute('data-video-poster', thumbnailURL);
                cardDiv.setAttribute('data-video-title', video.title);
                cardDiv.setAttribute('data-video-description', video.description);

                // Jika video berasal dari IndexedDB, tambahkan data-id
                if(isUserAdded && id !== null){
                    cardDiv.setAttribute('data-video-id', id);
                }

                // Thumbnail Image
                const imgElement = document.createElement('img');
                imgElement.src = thumbnailURL;
                imgElement.className = 'card-img-top';
                imgElement.alt = video.title;
                imgElement.loading = 'lazy';

                // Overlay Play Icon
                const overlayDiv = document.createElement('div');
                overlayDiv.className = 'thumbnail-overlay';
                const playIcon = document.createElement('i');
                playIcon.className = 'fas fa-play-circle';
                overlayDiv.appendChild(playIcon);

                // Delete Button (hanya untuk video yang ditambahkan pengguna)
                let deleteBtn = null;
                if(isUserAdded && id !== null){
                    deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn-delete';
                    deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
                    deleteBtn.title = 'Hapus Video';
                    deleteBtn.addEventListener('click', function(event){
                        event.stopPropagation(); // Mencegah event click ke card
                        const confirmDelete = confirm('Apakah Anda yakin ingin menghapus video ini?');
                        if(confirmDelete){
                            deleteVideo(id, colDiv);
                        }
                    });
                }

                // Card Body
                const cardBodyDiv = document.createElement('div');
                cardBodyDiv.className = 'card-body d-flex flex-column';

                const cardTitle = document.createElement('h5');
                cardTitle.className = 'card-title';
                cardTitle.textContent = video.title;

                const cardText = document.createElement('p');
                cardText.className = 'card-text';
                cardText.textContent = video.description;

                const btn = document.createElement('button');
                btn.className = 'btn btn-primary mt-auto';
                btn.textContent = 'Selengkapnya';

                cardBodyDiv.appendChild(cardTitle);
                cardBodyDiv.appendChild(cardText);
                cardBodyDiv.appendChild(btn);

                // Jika video adalah user-added, tambahkan tombol hapus
                if(deleteBtn){
                    cardDiv.appendChild(deleteBtn);
                }

                cardDiv.appendChild(imgElement);
                cardDiv.appendChild(overlayDiv);
                cardDiv.appendChild(cardBodyDiv);

                colDiv.appendChild(cardDiv);
                videoGrid.appendChild(colDiv);
            }

            // Function to save video to IndexedDB
            function saveVideoToDB(video) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction(['userVideos'], 'readwrite');
                    const objectStore = transaction.objectStore('userVideos');
                    const request = objectStore.add(video);

                    request.onsuccess = function(event) {
                        console.log('Video berhasil disimpan ke IndexedDB.');
                        resolve(event.target.result); // Mengembalikan ID video yang baru disimpan
                    };

                    request.onerror = function(event) {
                        console.error('Error menyimpan video:', event.target.error);
                        reject(event.target.error);
                    };
                });
            }

            // Function to load user videos from IndexedDB
            function loadUserVideosFromDB() {
                const transaction = db.transaction(['userVideos'], 'readonly');
                const objectStore = transaction.objectStore('userVideos');
                const request = objectStore.getAll();

                request.onsuccess = function(event) {
                    const videos = event.target.result;
                    videos.forEach(video => {
                        // Membuat URL dari Blob
                        const videoURL = URL.createObjectURL(video.src);
                        const posterURL = video.poster ? URL.createObjectURL(video.poster) : 'https://via.placeholder.com/320x180.png?text=Video'; // Thumbnail dihasilkan otomatis
                        addVideoCard({ 
                            title: video.title, 
                            description: video.description, 
                            src: videoURL, 
                            poster: video.poster 
                        }, true, video.id); // Tandai sebagai user-added dengan ID
                    });
                };

                request.onerror = function(event) {
                    console.error('Error memuat video dari IndexedDB:', event.target.error);
                };
            }

            // Function to delete video from IndexedDB and UI
            function deleteVideo(id, cardElement) {
                const transaction = db.transaction(['userVideos'], 'readwrite');
                const objectStore = transaction.objectStore('userVideos');
                const request = objectStore.delete(id);

                request.onsuccess = function() {
                    console.log('Video berhasil dihapus dari IndexedDB.');
                    // Hapus elemen card dari UI
                    cardElement.remove();
                    alert('Video berhasil dihapus.');
                };

                request.onerror = function(event) {
                    console.error('Error saat menghapus video pengguna:', event.target.error);
                    alert('Gagal menghapus video.');
                };
            }

            // Reset Gallery Functionality
            const resetGalleryBtn = document.getElementById('resetGalleryBtn');
            resetGalleryBtn.addEventListener('click', function() {
                if(confirm('Apakah Anda yakin ingin mereset gallery? Semua video yang diunggah pengguna akan dihapus.')) {
                    resetGallery();
                }
            });

            function resetGallery() {
                const transaction = db.transaction(['userVideos'], 'readwrite');
                const objectStore = transaction.objectStore('userVideos');
                const request = objectStore.clear();

                request.onsuccess = function() {
                    console.log('Semua video pengguna berhasil dihapus dari IndexedDB.');
                    // Hapus semua video pengguna dari tampilan (berdasarkan URL yang dihasilkan dari Blob)
                    const userVideos = videoGrid.querySelectorAll('.btn-delete');
                    userVideos.forEach(btn => {
                        const col = btn.closest('.col-lg-2, .col-md-3, .col-sm-4');
                        if (col) {
                            // Bersihkan URL objek
                            const img = col.querySelector('img');
                            if (img && img.src.startsWith('blob:')) {
                                URL.revokeObjectURL(img.src);
                            }
                            col.remove();
                        }
                    });
                    alert('Gallery telah direset ke default.');
                };

                request.onerror = function(event) {
                    console.error('Error saat menghapus video pengguna:', event.target.error);
                    alert('Gagal mereset gallery.');
                };
            }
        });
    </script>
</body>
</html>
